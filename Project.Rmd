---
title: "The Evolution of Speed and Performance in Formula 1"
output:
  html_document:
    self_contained: yes
    toc: yes
    toc_float: yes
    code_folding: hide
    df_print: "default"
urlcolor: blue
---

```{r setup, include = FALSE}
# Global chunk options: hide code, suppress messages/warnings
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE,
  fig.align = "center",
  fig.width = 7,
  fig.height = 4.5
)
```
**Author**  
Leslie Huh, Nick Jitjang, Shria Parupudi, Sohum Walavalkar


***
***


# Project Overview

### Motivation
Formula 1 is a sport where very small differences in pace, reliability, and strategy can completely change the outcome of a race. Fans and teams regularly debate what matters most: how fast the cars are over a stint, how reliable they are over a season, whether qualifying position locks in the result, or whether pit stops and race strategy make the real difference. Since almost every aspect of an F1 weekend is measured (lap times, pit stop durations, grid positions, final results) the sport provides a rich setting to study these questions using real data rather than just opinions.

In this project, we use historical F1 data to take a broader view of performance. Instead of focusing on a single race or driver, we combine information across many seasons to look at how pace, reliability, qualifying, and pit stops all contribute to race and season outcomes. This makes the project interesting both from a sports perspective and a statistical perspective as the dataset is large, structured, and naturally lends itself to methods like time series plots, clustering, and PCA that we have learned in class.

### Dataset Description

We use the Formula 1 World Championship dataset from Kaggle. The main tables we use are:

*insert table 


### Research Questions

Detailed item (rated 0 to 5). What is the quality of the research questions? Are they well-motivated by
real-world/scientific interests? Or are they shallow? For example, a very shallow question would be
in the form, “what does the distribution of this variable look like?” - three questions like this would
guarantee 0pts for this item. A more interesting question would motivate why we would like to inspect
particular distributions with real-world context.

**RQ1: How have race pace and reliability changed over time across eras?**

**RQ2: How Do Drivers’ Lap Times Change Over the Course of a Race?**

**RQ3: How Does Qualifying Performance Affect Final Race Outcomes?**

**RQ4: How Do Pit Stop Durations Influence Race Finishes and Season Rankings?**

***
***


# Research Question 1: How have race pace and reliability changed over time across eras?

### Motivation
In Formula 1, both race pace and reliability largely dictate how each driver performs. The faster the race pace, the faster the driver can drive, which increases their chance of winning. On the other hand, reliability is also a critical factor as cars need to be able to finish the race without problems that would interfere with the driving. Therefore, it would be worthwhile for us to investigate these two factor and how they evolve over time as teams adopt new engine regulations and introduce new technologies. Because engine eras are strongly tied to performance and durability, studying how fastest-lap speeds and DNF (Did Not Finish) rates change across eras would help us understand whether newer regulations made cars faster or more reliable. This is espcially interesting as F1 is making a transtion from bigger more powerful engine to a smaller engine that features more technonology and more friendly to the environment. Thus, the two graphs below would help us understand how reliability and race has evolved over time.

Note: for this question, we will only focus on 1989 - 2024 even though the dataset has information starting from 1950. This is because the data for fastest lap, which is used to interpret the race pace section, does not have data before 1989. Thus, to make the eras consistent for the two graphs, we will focus on 1989-2024 or the "modern era".

### Visualization 1
This graph displays how race reliability evolves over time by plotting:

- x-axis: year

- y-axis: mean DNF rate per race in that season

- color: engine/technical era (The F1 eras aren't given to us directly from the dataset, but we are able to make that up using public information on what kind of engines were use during each year to creating grouping.)

A time-series line plot is appropriate here as we are tracking how a different engines eras changes over chronological time and what impact that those has on the average DNF rates for each race aggregated across the different years. The plot provides a good concrete performance metric to assess the reliability of F1 cars over time. Since we can't really measure "reliability" directly, the graph helps us interpret this information by coming up with a measurement of DNF per season that highlights how reliability is increasing or decreasing. Thus, we are able to answer the original question for the reliability part that the reliability have been increasing over the time and eras of F1.

```{r}
library(tidyverse)


results <- read_csv("results.csv")
races   <- read_csv("races.csv")
status  <- read_csv("status.csv")
classified_keywords <- c("Finished", "Lap")
f1_reliability <- results %>%
  inner_join(races,  by = "raceId") %>%
  inner_join(status, by = "statusId") %>%
  group_by(raceId, year, name) %>%
  summarise(
    starters = n(),
    dnfs     = sum(!str_detect(status, paste(classified_keywords, collapse = "|"))),
    dnf_rate = dnfs / starters,
    .groups  = "drop"
  ) %>%
  mutate(
    era = case_when(
      year >= 1989 & year <= 2005 ~ "1989–2005: 3.0/3.5L V10/V8",
      year >= 2006 & year <= 2013 ~ "2006–13: 2.4L V8",
      year >= 2014               ~ "2014– : 1.6L V6 turbo-hybrid",
      TRUE                       ~ NA_character_
    )
  ) %>%
  tidyr::drop_na(era)

f1_reliability_year <- f1_reliability %>%
  group_by(year, era) %>%
  summarise(
    mean_dnf_rate = mean(dnf_rate),
    .groups       = "drop"
  )

f1_reliability_year %>%
  ggplot(aes(x = year,
             y = mean_dnf_rate,
             color = era,
             group = era)) +
  geom_line() +
  geom_point() +
  labs(
    title = "Formula 1 Reliability Over Time by Engine/Technical Era",
    x     = "Season (year)",
    y     = "Average DNF rate per race",
    color = "Engine / technical era"
  ) +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1))
```

### Interpretation 

We can observe a clear downward trend in DNF rates across eras, showing that the reliability of the F1 cars have increased significantly over the years as they are switching to a more reliable engine and the DNF per season is going down. The most interesting era is the 1989-2005 era when the average DNF goes down drastically over the year when F1 cars were using v8 and v10 engines. This is a very important time of F1 as F1 was still focusing largely on naturally aspirated engines. Then, in the 2.4L V8 era from 2006-2013, the DNF rates jumps to a higher level compared to the last year of the previous era, but starts decreasing to lower level than the previous era after that. The 1.6L hybrid era from 2014 - present (2024) shows a similar trend where the DNF rate jumps to a higher level initially and decreases, showing the lowest DNF levels overall. Thus, we see a trend here where the DNF rates are decreasing for each era as time progresses, and the DNF rate can spike a little when there is a transition. However, a newer and more technological advanced engine still achieves a lower DNF rate than the previous era. Therefore, the steady decline across eras suggests that engineering, safety, and component durability have all improved substantially.


### Visualization 2

This plot shows how the race pace of winning drivers changes across three modern engine eras by plotting:

- x-axis: engine/technical era 

- y-axis: winner’s fastest lap speed

A boxplot is used here because it summarizes the full distribution of lap speeds within each era (median, quartiles, and variability). By examining the fastest-lap speed, we can measure how race pace, how variable of interest, changes over the time as faster lap speed corresponds to faster race pace. Since pace is a continuous measurement and eras are categorical, boxplots allow us to  compare of how pace distributions shift across eras to help us answer our research question for the race pace part.

```{r}
f1_pace <- results %>%
  filter(positionOrder == 1) %>%
  mutate(
    # Treat "\N" as missing, then convert to numeric
    fastestLapSpeed = na_if(fastestLapSpeed, "\\N"),
    fastestLapSpeed = as.numeric(fastestLapSpeed)
  ) %>%
  drop_na(fastestLapSpeed) %>%
  inner_join(races, by = "raceId") %>%
  mutate(
    era = case_when(
      year >= 1989 & year <= 2005 ~ "1989–2005: 3.0/3.5L V10/V8",
      year >= 2006 & year <= 2013 ~ "2006–13: 2.4L V8",
      year >= 2014               ~ "2014– : 1.6L V6 turbo-hybrid",
      TRUE                       ~ NA_character_ 
    )
  ) %>%
  drop_na(era)

f1_pace %>%
  ggplot(aes(x = era, y = fastestLapSpeed)) +
  geom_boxplot() +
  labs(
    title = "Distribution of Winner's Fastest Lap Speed by Engine/Technical Era",
    x     = "Engine / technical era",
    y     = "Winner's fastest lap speed (km/h)"
  ) 
```

### Interpretation 
The boxplot shows an interesting insight of the race pace across eras. First, we can see that peak lap speeds were highest in the 1989–2005 V10/V8 era, reflecting powerful naturally-aspirated engines shown by the outlines. We can also see that the median speed for this V10/V8 era is also the highest among the three eras, and that the distribution seems to be the least variable as the box and line are not wide compared to the other eras, suggesting that the bigger engines seem to allow for faster and more consistent lap speed. Looking at the 2.4L V8 era, the median fastest lap speed seems to be the lowest among the three eras as F1 makes a transition to a smaller engine. This is further supported by looking at the lower quartile where this era has the lowest quartile lap speed overall. However, within the hybrid era, the upper whiskers, upper quartile, and median rise again, indicating that hybrid technology has steadily improved over time. We can also see that the upper quartile is higher than the V10/V8 era in addition to the upper whisker being taller. Thus, we can see that the race pace is improving within this era again, although it may not be as consistent as the old big naturally aspirated V10/V8 era. Therefore, this supports the idea that engine regulation changes meaningfully affect race pace.

### Conclusion

The two visuals collectively show that race pace and reliability were definitely influence by the engines and technical eras of Formula 1. As we make more technological advancement and engineering changes from bigger engines to a smaller and more environmentally friendly engine, we see a fluctuations in performance and reliability, affecting how the sport needs to adapt to changing rule and condition. First, We can see that the overall trend for reliability has been on a positive side where the engines are becoming more and more reliable with each passing year as DNF rate has been decreasing throughout with some fluctuations transitioning from era to era. Even though we get a more reliable engine, we can also see that the smaller engine seems to be slowing down the race pace over the year as there is more variability in the fastest lap speed from the two latest eras. However, the most recent hybrid era seems to be catching up with the old big engine as the sport continues to make engineering advancements. Therefore, the engine eras positively affects the reliability as it has been improving over time while the race pace struggled initally due to smaller engine, but are improving with the recent hybrid advancement.

### Further Research

While our analysis provides an interesting insight, it is still limited due to only using a few factor to consider a large question. In other words, our work only focuses on DNF to measure reliability and fastest lap speed to consider race pace. Future work could explore several unanswered questions about race pace and reliability and go in more detail for each. For instance, while reliability generally improves across eras, variability within periods like the early V10/V8 era suggests underlying technical or circuit-specific factors not captured in our dataset. We could analyze the weather, tire strategies, or also examining the cause of DNF (which can be caused by a crash rather than the car's fault) to fully unfold how each affect race pace and reliability as team makes different decisions to try to win the race. Additionally, our current analysis focuses only on winners’ pace while richer insights could come from examining all-driver pace distributions (which is not captured by the dataset) to make sure that the data is more representative of the full era. These directions were beyond the scope of this project due to data limitations and the need for more advanced statistical methods, but they could lead to a more complete understanding of how F1 technology and regulations shape on-track performance.

***
***

# Research Question 2: 

### Motivation
[PUT YOUR ANSWER HERE: 1 short paragraph connecting RQ1 to the real-world / scientific context.]

### Visualization 1
Detailed item (0 to 5). What is the quality of these graphs? Are these graphs easily readable,
interpretable, and properly labeled?
• Detailed item (0 to 5). Are the graphs well-motivated, given the research questions of the project?
In other words, do the graphs address/answer the research questions of the project, or do they only
provide tangential (or even irrelevant) details?
[[PUT YOUR ANSWER HERE: describe the variables and justify graph choice.]]

```{r}
#graph1
```

### Interpretation 
[PUT YOUR ANSWER HERE: additional interpretation, if applicable.]
 Detailed item (0 to 4). What is the quality of these descriptions? After reading these descriptions, is it
crystal clear what is being displayed in the graph and what the main takeaways are?


### Visualization 2

[[PUT YOUR ANSWER HERE: describe the variables and justify graph choice.]]

```{r}
#graph1
```

### Interpretation 
[PUT YOUR ANSWER HERE: additional interpretation, if applicable.]
Detailed item (0 to 4). What is the quality of these descriptions? After reading these descriptions, is it
crystal clear what is being displayed in the graph and what the main takeaways are?

### Conclusion

Does the report provide some clear conclusions that can be made from their
graphs and analyses?
• Detailed item (0 to 6). What is the accuracy of the claims being made? Are the claims well-supported
by the graphs and analyses presented? Are the conclusions well-aligned with the research questions of
the project?

### Further Research

Does the report discuss questions that have not been answered by the
project, but could be answered with future work?
• Detailed item (0 to 4). Did the team provide adequate reasons as to why these questions were left as
future work (e.g., they need more data, need more nuanced statistical techniques they haven’t learned,
etc.)? Are these future-work questions well-motivated given what the team has completed for this
project?

***
***

# Research Question 3: How Does Qualifying Performance Affect Final Race Outcomes?
### Motivation
Qualifying is often described as “half the race” in Formula 1, especially on tracks where overtaking is difficult. Teams invest huge effort into one-lap pace and grid position, but on race day we still see drivers moving forward or dropping back. For this research question, I focus on quantifying how strongly qualifying performance is tied to final race outcomes at the season level. In other words, if a driver generally starts near the front, do they reliably finish near the front, and how different is the experience for drivers who usually start in the midfield or at the back?

### Visualization 1
For the first visualization, I made a scatterplot where each point represents one driver-season. The x axis shows that driver’s average qualifying position for the season, and the y axis shows their average finishing position, with both axes reversed so that smaller numbers (better positions) appear toward the top-right. I color the points using the cluster labels from hierarchical clustering so that seasons with similar qualifying and race performance are grouped visually. This graph directly addresses my question by showing how starting positions and finishing positions move together across seasons, and whether there are clear patterns such as front-running, midfield, and backmarker seasons.

```{r}
library(tidyverse)

results <- read_csv("results.csv")
qualifying <- read_csv("qualifying.csv")
races <- read_csv("races.csv")
drivers <- read_csv("drivers.csv")

# driver-race level data: merge results + qualifying + race info
driver_race <- results %>%
  filter(!is.na(positionOrder)) %>%               
  inner_join(qualifying %>%
      select(raceId, driverId, quali_position = position),
    by = c("raceId", "driverId")) %>%
  inner_join(races %>% select(raceId, year), by = "raceId")

# aggregate to driver-season level (so each row = 1 driver in 1 year)
driver_season <- driver_race %>%
  filter(year >= 2006) %>%                        
  group_by(driverId, year) %>%
  summarise(
    races          = n(),
    avg_quali_pos  = mean(quali_position, na.rm = TRUE),
    avg_grid_pos   = mean(grid, na.rm = TRUE),
    avg_finish_pos = mean(positionOrder, na.rm = TRUE),
    avg_pos_change = mean(grid - positionOrder, na.rm = TRUE),
    total_points   = sum(points, na.rm = TRUE), .groups = "drop") %>%
  filter(races >= 5) %>%                        
  inner_join(drivers %>%
      mutate(driver_name = paste(forename, surname)) %>%
      select(driverId, driver_name), by = "driverId")

# numeric matrix for clustering (prof-style)
f1_quant <- driver_season %>%
  select(avg_quali_pos, avg_finish_pos, avg_pos_change, total_points) %>%
  as.data.frame()

rownames(f1_quant) <- paste(driver_season$driver_name, driver_season$year)

# scale (divide by SD only), distance, hierarchical clustering
f1_scaled <- scale(
  f1_quant,
  center = FALSE,
  scale  = apply(f1_quant, 2, sd, na.rm = TRUE))

f1_dist <- dist(f1_scaled)
hc_complete <- hclust(f1_dist, method = "complete")

# cut tree to get cluster labels
k <- 4   # you can try 3, 4, 5 and see what makes sense
driver_season$cluster <- factor(cutree(hc_complete, k = k))

table(driver_season$cluster)

# plot: avg qualifying vs avg finish, coloured by cluster

ggplot(driver_season, aes(x = avg_quali_pos, y = avg_finish_pos, colour = cluster)) + geom_point() +
  scale_x_reverse() +   
  scale_y_reverse() +   
  labs(x = "Average qualifying position (1 = best)", y = "Average finishing position (1 = best)", title = "How qualifying relates to race results (F1 driver seasons)", colour = "Cluster") 


# make a simple quali group 

driver_season$quali_group <- "Back"
driver_season$quali_group[driver_season$avg_quali_pos <= 10] <- "Mid"
driver_season$quali_group[driver_season$avg_quali_pos <= 5]  <- "Front"
```

### Interpretation 
For the first scatterplot, each dot is one driver in one season. On the x-axis I plotted the driver’s average qualifying position for that year, and on the y-axis I plotted their average finishing position. Both axes are reversed so that 1 (best) is at the top-right. I used the cluster labels from my hierarchical clustering to colour the points. The cloud of points lies roughly along a diagonal line: seasons where a driver usually qualifies near the front also tend to be seasons where they finish near the front, and seasons with poor qualifying are usually seasons with poor results. The different colours just break this overall pattern into groups. One cluster is mostly “front-running” seasons, where drivers qualify well and also finish well. Another cluster contains “backmarker” seasons, where drivers tend to start and finish near the back. The other clusters are more like midfield seasons. You can also see that some points sit a little above or below the main diagonal, which are seasons where drivers slightly under or over perform their usual qualifying position on race day.


### Visualization 2

For the second visualization, I plot the density of average positions gained, defined as grid minus finish, for three qualifying groups: Front (average qualifying positions 1 to 5), Mid (6 to 10), and Back (11 or worse). Each curve shows the distribution of race-day gains or losses for that group on the same x axis, and I add a dashed vertical line at zero to mark no net change in position. This density plot is useful because it lets me compare how much drivers from different qualifying groups typically move through the field over a season, rather than just comparing single averages, and it complements the first plot by focusing specifically on raceday position changes. 

```{r}
# plot 2: density of avg positions gained

ggplot(driver_season, aes(x = avg_pos_change, colour = quali_group)) +
  geom_density() +
  geom_vline(xintercept = 0, linetype = "dashed") +
  labs(x = "Avg positions gained (grid-finish)", y = "Density",
       colour = "Quali group", title = "Race-day gains/losses by qualifying group")
```

### Interpretation 
For the second graph, I wanted to look more directly at how much drivers move up or down in races depending on how they usually qualify. I first created a simple variable that puts each driver-season into one of three qualifying groups based on their average qualifying position: “Front” (positions 1 to 5), “Mid” (6 to 10), and “Back” (11+). Then I plotted the density of average positions gained (grid - finish) for each group on the same x axis, and added a dashed vertical line at 0. Values to the right of 0 mean the driver tends to gain places; values to the left mean they usually lose places. The curves show that 'back of the grid' drivers are generally shifted to the right of 0, so they tend to make up a couple of spots during the race. The front and mid groups are more centred around 0 or slightly to the left, which means that when you already start near the front, you do not usually gain a lot of positions and sometimes lose a bit instead. Together, these two graphs show that qualifying is very strongly related to where you finish overall, and that drivers who start further back have more room to gain spots, but they still usually do not end up matching the results of the consistently strong qualifiers


### Conclusion

Taken together, my two graphs show that qualifying performance is very strongly connected to final race outcomes, but not in a completely deterministic way. The clustered scatterplot demonstrates a clear upward relationship between average qualifying position and average finishing position: seasons where drivers usually start near the front also tend to be seasons where they finish near the front, and seasons with poor qualifying are usually seasons with poor results. The clusters highlight distinct groups of seasons that match F1 intuition: front-running seasons, midfield seasons, and backmarker seasons.

The density plot adds more nuance by looking at how many positions drivers typically gain or lose on race day. Drivers who usually qualify at the back tend to gain a few places on average, while front and mid-field qualifiers are centred around zero or slightly negative changes, meaning they mostly hold position or lose a little. This supports the idea that qualifying matters a lot: starting ahead gives a strong baseline advantage, and even though drivers starting further back can move forward, they rarely 'erase' the gap to consistently strong qualifiers over a full season.

### Further Research

Further research on this question could look at qualifying and race outcomes with more formal models rather than just summaries and plots. For example, we could fit a regression model with finishing position or points as the response and grid position as a predictor, while also controlling for team, circuit, and season to separate the effect of qualifying from car and track differences. Another extension would be to move from season averages to race by race data, to see how the qualifying-finish relationship changes across different circuits or eras. These ideas would likely require more detailed modelling and additional variables than we used in this project, so we treat them as directions for future work rather than part of the current analysis.

***
***

# Research Question 4: 

### Motivation
[PUT YOUR ANSWER HERE: 1 short paragraph connecting RQ1 to the real-world / scientific context.]

### Visualization 1
Detailed item (0 to 5). What is the quality of these graphs? Are these graphs easily readable,
interpretable, and properly labeled?
• Detailed item (0 to 5). Are the graphs well-motivated, given the research questions of the project?
In other words, do the graphs address/answer the research questions of the project, or do they only
provide tangential (or even irrelevant) details?
[[PUT YOUR ANSWER HERE: describe the variables and justify graph choice.]]

```{r}
#graph1
```

### Interpretation 
[PUT YOUR ANSWER HERE: additional interpretation, if applicable.]
 Detailed item (0 to 4). What is the quality of these descriptions? After reading these descriptions, is it
crystal clear what is being displayed in the graph and what the main takeaways are?


### Visualization 2

[[PUT YOUR ANSWER HERE: describe the variables and justify graph choice.]]

```{r}
#graph1
```

### Interpretation 
[PUT YOUR ANSWER HERE: additional interpretation, if applicable.]
Detailed item (0 to 4). What is the quality of these descriptions? After reading these descriptions, is it
crystal clear what is being displayed in the graph and what the main takeaways are?

### Conclusion

Does the report provide some clear conclusions that can be made from their
graphs and analyses?
• Detailed item (0 to 6). What is the accuracy of the claims being made? Are the claims well-supported
by the graphs and analyses presented? Are the conclusions well-aligned with the research questions of
the project?

### Further Research

Does the report discuss questions that have not been answered by the
project, but could be answered with future work?
• Detailed item (0 to 4). Did the team provide adequate reasons as to why these questions were left as
future work (e.g., they need more data, need more nuanced statistical techniques they haven’t learned,
etc.)? Are these future-work questions well-motivated given what the team has completed for this
project?

***
***

# Wrapping up





